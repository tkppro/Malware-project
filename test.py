import os
import hashlib
import json

fil=""


def read_file_json():
    with open('data.json') as json_file:
        data = json.load(json_file)
        return data


def hash_function(filename):
    md5 = hashlib.md5()
    with open(filename, 'rb') as f:
        buf = f.read()
        # MD-5
        md5.update(buf)
    return md5.hexdigest()


def delete_file(virus):
    os.remove(virus)


def quick_scan(path):
    data = read_file_json()
    count = 0
    global fil
    fileList = []
    print("Path: ",path)
    for r, d, f in os.walk(path):
        for file in f:
            if file.endswith("exe"):
                print("File :", file)
                count += 1
                fil = os.path.join(r, file)
                print("file name 1: ", fil)
            for data_el in data:
                print("file name 2: ", fil)
                h = hash_function(fil)
                print("hash file: ", h)
                print("hash data: ", data_el['md5'])
                if h != data_el['md5']:
                    print("Unidentified Virus")
                else:
                    print('Virus ' + data_el['name'] + ' found!')
                    print('Deleting: ' + fil)
                    delete_file(fil)
                    count -= 1
                    break

    print("Numbers of unidentified virus: ",count)


path = 'C:\\Users\\tranv\\Desktop\\virusCopy'
quick_scan(path)